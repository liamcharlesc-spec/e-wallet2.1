<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ePay â€” QR Send/Receive</title>
<style>
:root{
  --bg-gradient: linear-gradient(180deg,#0b0f1a 0%, #1a2030 100%);
  --accent-neon:#00ffcc;
  --cta-green:#4bb06d;
  --text-light:#f0f0f0;
  --input-bg:rgba(255,255,255,0.05);
}

*{box-sizing:border-box;}
body{
  background:var(--bg-gradient);
  font-family: Inter, system-ui, "Segoe UI", Roboto, Arial;
  display:flex;
  justify-content:center;
  padding:20px;
  min-height:85vh;
  color:var(--text-light);
}
.phone{
  width:360px;
  border-radius:28px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  min-height:780px;
  box-shadow:0 8px 30px rgba(0,0,0,0.3);
  position:relative;
  padding:20px;
}

.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}
.top h2{
  font-size:18px;
  color:var(--accent-neon);
}
.back-btn{
  font-size:18px;
  cursor:pointer;
  color:var(--accent-neon);
}

/* Tabs */
.tabs{
  display:flex;
  justify-content:space-around;
  margin-bottom:12px;
}
.tab{
  flex:1;
  padding:8px;
  text-align:center;
  border-radius:16px;
  cursor:pointer;
  background:rgba(255,255,255,0.05);
  transition:0.3s;
  font-weight:600;
}
.tab.active{
  background:var(--accent-neon);
  color:#000;
}

/* Form style */
.qr-form{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-bottom:20px;
}
.qr-form label{
  font-size:12px;
  opacity:0.8;
}
.qr-form input{
  padding:12px;
  border-radius:10px;
  border:none;
  background:var(--input-bg);
  color:var(--text-light);
  font-size:14px;
}
.qr-form .confirm{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:12px;
  margin-top:8px;
}
.qr-form button{
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:12px;
  background:var(--cta-green);
  color:white;
  font-weight:600;
  cursor:pointer;
  font-size:16px;
}

/* Video scan area */
#qr-video{
  width:100%;
  height:220px;
  border-radius:12px;
  background:#111;
  object-fit:cover;
  margin-bottom:12px;
  display:none;
}
.bottom-nav {
  display: flex;
  justify-content: space-evenly; /* evenly spaces nav items */
  align-items: center;
  background: rgba(0,0,0,0.4);
  border-radius: 16px;
  padding: 6px 0; /* internal padding */
  box-shadow: 0 6px 18px rgba(0,0,0,0.3);
  position: absolute;
  bottom: 12px;
  width: calc(100% - 40px); /* keep phone padding */
  left: 0;
  right: 0;
  margin: 0 auto; /* center horizontally */
}

.nav-item {
  flex: none; /* prevent stretching */
  text-align: center;
  cursor: pointer;
  padding: 6px 12px; /* add spacing around icons */
  border-radius: 12px;
  transition: 0.3s;
}

.nav-item.active {
  box-shadow: 0 0 10px var(--accent-neon), 0 0 20px var(--accent-neon);
}
.nav-item svg {
  width: 22px;
  height: 22px;
  stroke: white;
}


</style>
</head>
<body>

<div class="phone">
  <div class="top">
    <div class="back-btn" onclick="window.location.href='homedashboard.html'">&#8592; Home</div>
    <h2>Send / Receive</h2>
    <div></div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" id="send-tab">Send</div>
    <div class="tab" id="receive-tab">Receive</div>
  </div>

  <!-- Send form -->
  <div class="qr-form" id="send-form">
    <button onclick="toggleCamera()">Scan QR</button>
    <video id="qr-video"></video>

    <label>Send To:</label>
    <input type="text" id="recipient" placeholder="Enter phone number">

    <label>Amount (PHP):</label>
    <input type="number" id="amount" placeholder="Enter amount">

    <div class="confirm">
      <input type="checkbox" id="confirmCheck">
      <label for="confirmCheck">I confirm that the details here are correct</label>
    </div>

    <button onclick="sendMoney()">Send</button>
  </div>

  <!-- Receive form -->
  <div class="qr-form" id="receive-form" style="display:none; text-align:center;">
    <p>Share this QR code to receive money:</p>
    <canvas id="receive-qr"></canvas>
  </div>

  <!-- Bottom nav -->
  <div class="bottom-nav">
    <div class="nav-item" onclick="window.location.href='homedashboard.html'">
      <svg viewBox="0 0 24 24" fill="none"><path d="M3 11l9-7 9 7"/><path d="M9 22V12h6v10"/></svg>
    </div>
    <div class="nav-item" onclick="window.location.href='notifications.html'">
      <svg viewBox="0 0 24 24" fill="none"><path d="M18 8a6 6 0 10-12 0v5l-2 2h16l-2-2V8z"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
    </div>
    <div class="nav-item active">
      <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="6" height="6" rx="1"/><rect x="15" y="3" width="6" height="6" rx="1"/><rect x="3" y="15" width="6" height="6" rx="1"/><rect x="15" y="15" width="6" height="6" rx="1"/></svg>
    </div>
    <div class="nav-item" onclick="window.location.href='profile.html'">
      <svg viewBox="0 0 24 24" fill="none"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@zxing/library@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
const sendTab = document.getElementById('send-tab');
const receiveTab = document.getElementById('receive-tab');
const sendForm = document.getElementById('send-form');
const receiveForm = document.getElementById('receive-form');
const videoElement = document.getElementById('qr-video');
let cameraActive = false;
let codeReader = null;

// Tabs
sendTab.addEventListener('click', ()=>{
  sendTab.classList.add('active');
  receiveTab.classList.remove('active');
  sendForm.style.display = 'flex';
  receiveForm.style.display = 'none';
});
receiveTab.addEventListener('click', ()=>{
  receiveTab.classList.add('active');
  sendTab.classList.remove('active');
  sendForm.style.display = 'none';
  receiveForm.style.display = 'flex';
  generateReceiveQR();
});

// QR Scanner
function toggleCamera(){
  if(cameraActive){
    codeReader.reset();
    videoElement.style.display = 'none';
    cameraActive = false;
  } else {
    videoElement.style.display = 'block';
    codeReader = new ZXing.BrowserQRCodeReader();
    codeReader
      .listVideoInputDevices()
      .then(videoInputDevices=>{
        const deviceId = videoInputDevices[0].deviceId;
        return codeReader.decodeFromVideoDevice(deviceId, 'qr-video', (result, err)=>{
          if(result){
            document.getElementById('recipient').value = result.text;
            codeReader.reset();
            videoElement.style.display = 'none';
            cameraActive = false;
          }
        });
      }).catch(err=>console.error(err));
    cameraActive = true;
  }
}

// Send money
function sendMoney(){
  const recipient = document.getElementById('recipient').value.trim();
  const amount = parseFloat(document.getElementById('amount').value);
  const confirmChecked = document.getElementById('confirmCheck').checked;
  if(!recipient || isNaN(amount) || amount <= 0){
    alert("Enter a valid recipient and amount.");
    return;
  }
  if(!confirmChecked){
    alert("Please confirm that the details are correct.");
    return;
  }

  let walletBalance = parseFloat(localStorage.getItem('walletBalance')) || 0;
  if(amount > walletBalance){
    alert("Insufficient wallet balance.");
    return;
  }

  walletBalance -= amount;
  localStorage.setItem('walletBalance', walletBalance.toFixed(2));

  let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
  transactions.push({type:"Sent Money", amount:amount, recipient:recipient, date:new Date().toLocaleString()});
  localStorage.setItem('transactions', JSON.stringify(transactions));

  alert(`Success! PHP ${amount.toFixed(2)} sent to ${recipient}`);
  document.getElementById('recipient').value = '';
  document.getElementById('amount').value = '';
  document.getElementById('confirmCheck').checked = false;
}

// Generate receive QR
function generateReceiveQR(){
  const walletId = "user-wallet-"+localStorage.getItem('walletBalance'); // simple placeholder
  const canvas = document.getElementById('receive-qr');
  QRCode.toCanvas(canvas, walletId, {width:200}, function(err){
    if(err) console.error(err);
  });
}
</script>
</body>
</html>
